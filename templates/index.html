<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
<table>
    <tr>
        <td x="0" y="0">{{ cell.0 }}</td> <td x="1" y="0">{{ cell.1 }}</td> <td x="2" y="0">{{ cell.2 }}</td>
    </tr>
    <tr>
        <td x="0" y="1">{{ cell.3 }}</td> <td x="1" y="1">{{ cell.4 }}</td> <td x="2" y="1">{{ cell.5 }}</td>
    </tr>
    <tr>
        <td x="0" y="2">{{ cell.6 }}</td> <td x="1" y="2">{{ cell.7 }}</td> <td x="2" y="2">{{ cell.8 }}</td>
    </tr>
</table>
<div class="info"></div>
<button>reset</button>

<script>
$( "td" ).click(function() {
  var x = $( this ).attr( "x" );
  var y = $( this ).attr( "y" );
  $.post("/turn", { x: x, y: y }, function(result) {
    console.log(result);
    var lastTurn = result.last_turn;
    var nextTurn = result.next_turn;
    var winner = result.winner;
    if (winner) {
      $(".info").text("Winner: " + winner);
    } else if (nextTurn) {
      $(".info").text("Next turn: " + nextTurn);
    }
    $("[x=" + result.x + "][y=" + result.y + "]").text(lastTurn);
  });
});

$( "button" ).click(function() {
  $.post("/reset", {}, function(result) {
    console.log(result);
  });
});

function executeQuery() {
  $.ajax({
    url: '/state',
    success: function(result) {
      var x = result.x;
      var y = result.y;
      var lastTurn = result.last_turn;
      $("[x=" + x + "][y=" + y + "]").text(lastTurn);
      var winner = result.winner;
      var nextTurn = result.next_turn;
      if (winner) {
        $(".info").text("Winner: " + winner);
      } else if (nextTurn) {
        $(".info").text("Next turn: " + nextTurn);
      }
    }
  });
  setTimeout(executeQuery, 1000); // you could choose not to continue on failure...
}

$(document).ready(function() {
  // run the first time; all subsequent calls will take care of themselves
  setTimeout(executeQuery, 1000);
});
</script>

</body>
</html>